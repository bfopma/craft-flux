$(document).ready(function(){const u=$(".s3-key-id"),d=$(".s3-secret-key"),s=$(".s3-bucket-select > select"),n=$(".s3-refresh-buckets"),r=n.parent().next().children(),p=$(".s3-region");$(".s3-manualBucket"),$(".s3-manualRegion");let f=!1;const i=$(".cf-distribution-select > select"),a=$(".cf-refresh-distributions"),h=a.parent().next().children(),k=$(".cf-domain");let b=!1;n.click(function(){if(n.hasClass("disabled"))return;n.addClass("disabled"),r.removeClass("hidden");const c={keyId:u.val(),secret:d.val()};Craft.sendActionRequest("POST","flux/aws/load-bucket-data",{data:c}).then(({data:e})=>{if(!e.buckets.length)return;const l=s.val();let o=!1;f=!0,s.prop("readonly",!1).empty();for(let t=0;t<e.buckets.length;t++)e.buckets[t].bucket===l&&(o=!0),s.append('<option value="'+e.buckets[t].bucket+'" data-region="'+e.buckets[t].region+'">'+e.buckets[t].bucket+"</option>");o&&s.val(l),f=!1,o||s.trigger("change")}).catch(({response:e})=>{alert(e.data.message)}).finally(()=>{n.removeClass("disabled"),r.addClass("hidden")})}),s.change(function(){if(f)return;const c=s.children("option:selected");p.val(c.data("region"))}),a.click(function(){if(a.hasClass("disabled"))return;a.addClass("disabled"),h.removeClass("hidden");const c={keyId:u.val(),secret:d.val()};Craft.sendActionRequest("POST","flux/aws/load-distributions-data",{data:c}).then(({data:e})=>{if(!e.distributions.length)return;const l=i.val();let o=!1;b=!0,i.prop("readonly",!1).empty();for(let t=0;t<e.distributions.length;t++)e.distributions[t].id===l&&(o=!0),i.append('<option value="'+e.distributions[t].id+'" data-domain="'+e.distributions[t].domain+'">'+e.distributions[t].id+"</option>");o&&i.val(l),b=!1,o||i.trigger("change")}).catch(({response:e})=>{alert(e.data.message)}).finally(()=>{a.removeClass("disabled"),h.addClass("hidden")})}),i.change(function(){if(b)return;const c=i.children("option:selected");k.val(c.data("domain"))})});$(document).ready(function(){const u=$(".js-generate-user-policy"),d=$(".user-policy-modal"),s=new Garnish.Modal(d[0],{autoShow:!1});u.click(function(){const n={bucket:$('input[name="settings[manualBucket]"]').val(),root:$('input[name="settings[rootPrefix]"]').val()};Craft.sendActionRequest("POST","flux/aws/build-bucket-policy",{data:n,transformResponse:r=>r}).then(r=>{s.$container.find("pre > code").html(r.data),s.show()})})});
//# sourceMappingURL=flux.js.map
